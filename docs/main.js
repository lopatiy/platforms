!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n.r(e);var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=e,this.cc=this.canvas.getContext("2d")}return function(t,e,n){e&&i(t.prototype,e),n&&i(t,n)}(t,[{key:"width",value:function(){return this.canvas.clientWidth}},{key:"height",value:function(){return this.canvas.clientHeight}},{key:"stroke",value:function(t){!t&&(t="nostroke"),this.cc.strokeStyle=t}},{key:"fill",value:function(t){!t&&(t="transparent"),this.cc.fillStyle=t}},{key:"clear",value:function(){this.cc.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"point",value:function(t,e){this.ellipse(t,e,1)}},{key:"ellipse",value:function(t,e,n){this.cc.beginPath(),this.cc.ellipse(t,e,n,n,0,0,2*Math.PI),this.cc.stroke()}},{key:"line",value:function(t,e,n,i){this.cc.beginPath(),this.cc.moveTo(t,e),this.cc.lineTo(n,i),this.cc.stroke()}},{key:"sprite",value:function(t,e,n){this.cc.putImageData(t,e,n)}},{key:"shape",value:function(t){this.cc.beginPath(),this.cc.moveTo(t[0].x,t[0].y);for(var e=1;e<t.length;e++)this.cc.lineTo(t[e].x,t[e].y);this.cc.closePath(),this.cc.fill(),this.cc.stroke()}}]),t}();function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.load(e,108,47,n)}return function(t,e,n){e&&o(t.prototype,e),n&&o(t,n)}(t,[{key:"load",value:function(t,e,n,i){var r=this,o=document.createElement("img");o.onload=function(){var t=document.createElement("canvas");t.width=e,t.height=2*n,t.id="spritesCanvas",r.canvas=document.getElementById("spritesCanvas"),r.ctx=t.getContext("2d"),r.ctx.translate(e,0),r.ctx.scale(-1,1),r.ctx.drawImage(o,0,0,e,n),r.ctx.translate(e,0),r.ctx.scale(-1,1),r.ctx.drawImage(o,0,n,e,n),i(r.ctx.getImageData(0,0,e,n))},o.setAttribute("crossOrigin",""),o.src=t+"?"+(new Date).getTime()}},{key:"copy",value:function(){var t;return(t=this.ctx).getImageData.apply(t,arguments)}}]),t}();c(a,"spriteSheet",[[72,0,36,47],[0,47,36,47],[0,0,36,47],[72,47,36,47],[36,0,36,47],[36,47,36,47]]),c(a,"SPRITE",{IDLE:[a.spriteSheet[0],a.spriteSheet[1]],RUN:[[a.spriteSheet[2],a.spriteSheet[3]],[a.spriteSheet[4],a.spriteSheet[5]]]});var s=function(t,e){return[t[0]+e[0],t[1]+e[1]]};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(t,e){return!e||"object"!==u(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t,e,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function g(t,e,n){return e&&b(t.prototype,e),n&&b(t,n),t}var m=[0,.5],w=function(){function t(e,n){d(this,t),this.pos=[e,n],this.acc=[0,0],this.vel=[0,0]}return g(t,[{key:"update",value:function(){this.vel=s(this.vel,this.acc),this.pos=s(this.pos,this.vel)}}]),t}(),k=function(t){function e(t,n){var i;return d(this,e),(i=h(this,p(e).call(this,t,n))).dir=1,i.ground=n,i.sprite=a.SPRITE.IDLE[0],i}return y(e,w),g(e,[{key:"stop",value:function(){this.sprite=a.SPRITE.IDLE[0],this.vel[0]=0}},{key:"left",value:function(){this.dir=0,this.vel[0]=-3}},{key:"right",value:function(){this.dir=1,this.vel[0]=3}},{key:"duck",value:function(){}},{key:"jump",value:function(){this.isOnGround()?(this.applyJump(),this.doubleJumpAllowed=!0):this.doubleJumpAllowed&&(this.applyJump(),this.doubleJumpAllowed=!1)}},{key:"applyJump",value:function(){this.vel[1]=-6}},{key:"isOnGround",value:function(){return this.pos[1]>=this.ground}},{key:"update",value:function(){this.isOnGround()||(this.vel=s(this.vel,m)),f(p(e.prototype),"update",this).call(this),this.pos[1]>=this.ground&&(this.pos[1]=this.ground)}},{key:"render",value:function(t,e,n){var i;switch(!0){case Math.abs(this.vel[0])>0:i=a.SPRITE.RUN[Math.ceil(n%100/10)%2][this.dir];break;default:i=a.SPRITE.IDLE[this.dir]}this.isOnGround()||(i=a.SPRITE.IDLE[this.dir]);var r=this.pos[0]-i[2]/2,o=this.pos[1]-i[3],c=e.copy.apply(e,l(i));return t.sprite(c,r,o)}}]),e}(),O=function(t){function e(t,n){var i;return d(this,e),i=h(this,p(e).call(this,t,n)),document.addEventListener("keydown",function(t){switch(t.keyCode){case 65:case 37:i.left();break;case 68:case 39:i.right();break;case 87:case 38:i.jump();break;case 83:case 40:i.duck()}}),document.addEventListener("keyup",function(t){switch(t.keyCode){case 37:case 65:case 39:case 68:i.stop()}}),i}return y(e,k),e}();function S(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var P=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById("canvas"),this.h=document.body.scrollHeight,this.w=document.body.getBoundingClientRect().width,this.canvas.height=this.h,this.canvas.width=this.w,this.scene=new r(this.canvas),this.spritesManager=new a("../assets/hero.png",this.bootstrap.bind(this)),this.units=[]}return function(t,e,n){e&&S(t.prototype,e),n&&S(t,n)}(t,[{key:"bootstrap",value:function(){var t=this;this.place();var e=1e3;this.render(e),this.scene.cc.putImageData(this.spritesManager.ctx.getImageData(0,0,this.w,this.h),0,0),setInterval(function(){return t.render(e++)},1e3/24)}},{key:"place",value:function(){this.units.push(new O(this.w/2,3*this.h/4)),this.units.push(new k(3*this.w/4,3*this.h/4))}},{key:"render",value:function(t){this.scene.clear(),this.scene.line(0,3*this.h/4,this.w,3*this.h/4);for(var e=0;e<this.units.length;e++){var n=this.units[e];n.update(),n.render(this.scene,this.spritesManager,t)}}}]),t}();window.app=new P}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3NjZW5lLmpzIiwid2VicGFjazovLy8uL3NyYy9zcHJpdGVzLmpzIiwid2VicGFjazovLy8uL3NyYy9mbi5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvcG9pbnQuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiU2NlbmUiLCJjYW52YXMiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiY2MiLCJnZXRDb250ZXh0IiwiY2xpZW50V2lkdGgiLCJjbGllbnRIZWlnaHQiLCJjb2xvciIsInN0cm9rZVN0eWxlIiwiZmlsbFN0eWxlIiwiY2xlYXJSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJ4IiwieSIsImVsbGlwc2UiLCJiZWdpblBhdGgiLCJNYXRoIiwiUEkiLCJzdHJva2UiLCJ4MCIsInkwIiwieDEiLCJ5MSIsIm1vdmVUbyIsImxpbmVUbyIsInNwcml0ZSIsInB1dEltYWdlRGF0YSIsInBvaW50cyIsImxlbmd0aCIsImNsb3NlUGF0aCIsImZpbGwiLCJTcHJpdGVzTWFuYWdlciIsInVybCIsImNhbGxiYWNrIiwic3ByaXRlc19jbGFzc0NhbGxDaGVjayIsImxvYWQiLCJfdGhpcyIsImltYWdlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwib25sb2FkIiwiaWQiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsInRyYW5zbGF0ZSIsInNjYWxlIiwiZHJhd0ltYWdlIiwiZ2V0SW1hZ2VEYXRhIiwic2V0QXR0cmlidXRlIiwic3JjIiwiRGF0ZSIsImdldFRpbWUiLCJfdGhpcyRjdHgiLCJhcHBseSIsImFyZ3VtZW50cyIsIklETEUiLCJzcHJpdGVTaGVldCIsIlJVTiIsInN1bW0iLCJ2MSIsInYyIiwiZ3Jhdml0eSIsIlBvaW50IiwicG9pbnRfY2xhc3NDYWxsQ2hlY2siLCJwb3MiLCJhY2MiLCJ2ZWwiLCJwb2ludF9jcmVhdGVDbGFzcyIsIlVuaXQiLCJfUG9pbnQiLCJfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiIsIl9nZXRQcm90b3R5cGVPZiIsImRpciIsImdyb3VuZCIsIlNQUklURSIsIl9pbmhlcml0cyIsImlzT25Hcm91bmQiLCJhcHBseUp1bXAiLCJkb3VibGVKdW1wQWxsb3dlZCIsIl9nZXQiLCJzY2VuZSIsInNwcml0ZXMiLCJ0aW1lIiwiYWJzIiwiY2VpbCIsInJlc3VsdCIsImNvcHkiLCJfdG9Db25zdW1hYmxlQXJyYXkiLCJDb250cm9sbGFibGVVbml0IiwiX1VuaXQiLCJfdGhpczIiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImtleUNvZGUiLCJsZWZ0IiwicmlnaHQiLCJqdW1wIiwiZHVjayIsInN0b3AiLCJBcHBsaWNhdGlvbiIsInNyY19jbGFzc0NhbGxDaGVjayIsImgiLCJib2R5Iiwic2Nyb2xsSGVpZ2h0IiwidyIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInNwcml0ZXNNYW5hZ2VyIiwiYm9vdHN0cmFwIiwidW5pdHMiLCJwbGFjZSIsInJlbmRlciIsInNldEludGVydmFsIiwicHVzaCIsImNsZWFyIiwibGluZSIsInVuaXQiLCJ1cGRhdGUiLCJ3aW5kb3ciLCJhcHAiXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEtBR0EsU0FBQUMsRUFBQUMsR0FHQSxH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IFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNjZW5lIHtcbiAgICBjb25zdHJ1Y3RvcihjYW52YXMpIHtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgICAgIHRoaXMuY2MgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIH1cblxuICAgIHdpZHRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jYW52YXMuY2xpZW50V2lkdGhcbiAgICB9O1xuXG4gICAgaGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jYW52YXMuY2xpZW50SGVpZ2h0XG4gICAgfTtcblxuICAgIHN0cm9rZShjb2xvcikge1xuICAgICAgICAhY29sb3IgJiYgKGNvbG9yID0gJ25vc3Ryb2tlJyk7XG4gICAgICAgIHRoaXMuY2Muc3Ryb2tlU3R5bGUgPSBjb2xvclxuICAgIH07XG5cbiAgICBmaWxsKGNvbG9yKSB7XG4gICAgICAgICFjb2xvciAmJiAoY29sb3IgPSAndHJhbnNwYXJlbnQnKTtcbiAgICAgICAgdGhpcy5jYy5maWxsU3R5bGUgPSBjb2xvclxuICAgIH07XG5cbiAgICBjbGVhcigpe1xuICAgICAgICB0aGlzLmNjLmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICB9XG5cbiAgICBwb2ludCh4LCB5KSB7XG4gICAgICAgIHRoaXMuZWxsaXBzZSh4LCB5LCAxKVxuICAgIH07XG5cbiAgICBlbGxpcHNlKHgsIHksIHIpIHtcbiAgICAgICAgdGhpcy5jYy5iZWdpblBhdGgoKTtcbiAgICAgICAgdGhpcy5jYy5lbGxpcHNlKHgsIHksIHIsIHIsIDAsIDAsIDIgKiBNYXRoLlBJKTtcbiAgICAgICAgdGhpcy5jYy5zdHJva2UoKTtcbiAgICB9O1xuXG4gICAgbGluZSh4MCx5MCx4MSx5MSl7XG4gICAgICAgIHRoaXMuY2MuYmVnaW5QYXRoKCk7XG4gICAgICAgIHRoaXMuY2MubW92ZVRvKHgwLHkwKTtcbiAgICAgICAgdGhpcy5jYy5saW5lVG8oeDEseTEpO1xuICAgICAgICB0aGlzLmNjLnN0cm9rZSgpO1xuICAgIH1cblxuICAgIHNwcml0ZShzcHJpdGUsIHgsIHkpe1xuICAgICAgICB0aGlzLmNjLnB1dEltYWdlRGF0YShzcHJpdGUsIHgsIHkpO1xuICAgIH1cblxuICAgIHNoYXBlKHBvaW50cykge1xuICAgICAgICB0aGlzLmNjLmJlZ2luUGF0aCgpO1xuICAgICAgICB0aGlzLmNjLm1vdmVUbyhwb2ludHNbMF0ueCwgcG9pbnRzWzBdLnkpO1xuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBvaW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5jYy5saW5lVG8ocG9pbnRzW2ldLngsIHBvaW50c1tpXS55KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNjLmNsb3NlUGF0aCgpO1xuICAgICAgICB0aGlzLmNjLmZpbGwoKTtcbiAgICAgICAgdGhpcy5jYy5zdHJva2UoKTtcbiAgICB9O1xufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3ByaXRlc01hbmFnZXIge1xuXHRzdGF0aWMgc3ByaXRlU2hlZXQgPSBbXG4gICAgICAgIFs3MiwgMCwgMzYsIDQ3XSxcbiAgICAgICAgWzAsIDQ3LCAzNiwgNDddLFxuXG5cdFx0WzAsIDAsIDM2LCA0N10sIC8vbGVmdFxuICAgICAgICBbNzIsIDQ3LCAzNiwgNDddLCAvL3JpZ2h0XG5cbiAgICAgICAgWzM2LCAwLCAzNiwgNDddLCAvL2xlZnRcbiAgICAgICAgWzM2LCA0NywgMzYsIDQ3XSwgLy9yaWdodFxuICAgIF07XG5cblx0c3RhdGljIFNQUklURSA9IHtcblx0XHRJRExFIDogW1xuICAgICAgICAgICAgU3ByaXRlc01hbmFnZXIuc3ByaXRlU2hlZXRbMF0sXG4gICAgICAgICAgICBTcHJpdGVzTWFuYWdlci5zcHJpdGVTaGVldFsxXSxcblx0XHRdLFxuXHRcdFJVTiA6IFtcbiAgICAgICAgICAgIFtTcHJpdGVzTWFuYWdlci5zcHJpdGVTaGVldFsyXSwgU3ByaXRlc01hbmFnZXIuc3ByaXRlU2hlZXRbM11dLCAvLyBsZWZ0XG4gICAgICAgICAgICBbU3ByaXRlc01hbmFnZXIuc3ByaXRlU2hlZXRbNF0sIFNwcml0ZXNNYW5hZ2VyLnNwcml0ZVNoZWV0WzVdXSwgLy8gcmlnaHRcblx0XHRdXG5cdH07XG5cblx0Y29uc3RydWN0b3IodXJsLCBjYWxsYmFjayl7XG5cdFx0dGhpcy5sb2FkKHVybCwgMTA4LCA0NywgY2FsbGJhY2spXG5cdH1cblxuXHRsb2FkKHVybCwgd2lkdGgsIGhlaWdodCwgY2FsbGJhY2spIHtcbiAgIFx0XHRjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgIFx0aW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICBcdGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICBcdGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICBcdGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQgKjI7XG4gICAgICAgICAgICBjYW52YXMuaWQgPSAnc3ByaXRlc0NhbnZhcyc7XG5cbiAgICAgICAgXHR0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzcHJpdGVzQ2FudmFzJyk7XG4gICAgICAgIFx0dGhpcy5jdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgXHR0aGlzLmN0eC50cmFuc2xhdGUod2lkdGgsIDApO1xuICAgICAgICBcdHRoaXMuY3R4LnNjYWxlKC0xLDEpO1xuICAgICAgICBcdHRoaXMuY3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLmN0eC50cmFuc2xhdGUod2lkdGgsIDApO1xuICAgICAgICAgICAgdGhpcy5jdHguc2NhbGUoLTEsMSk7XG4gICAgICAgICAgICB0aGlzLmN0eC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIGhlaWdodCwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAgICAgXHRjYWxsYmFjayh0aGlzLmN0eC5nZXRJbWFnZURhdGEoMCwgMCwgd2lkdGgsIGhlaWdodCkpO1xuICAgIFx0fTtcblxuICAgIFx0aW1hZ2Uuc2V0QXR0cmlidXRlKCdjcm9zc09yaWdpbicsICcnKTtcbiAgICBcdGltYWdlLnNyYyA9IHVybCArICc/JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXHR9XG5cblx0Y29weSguLi5kYXRhKXtcblx0IFx0cmV0dXJuIHRoaXMuY3R4LmdldEltYWdlRGF0YSguLi5kYXRhKTtcblx0fVxufSIsImV4cG9ydCBjb25zdCBzdW1tID0gKHYxLHYyKSA9PiB7XG5cdHJldHVybiBbdjFbMF0rdjJbMF0sIHYxWzFdICsgdjJbMV1dO1xufVxuXG5leHBvcnQgY29uc3Qgc3VidCA9ICh2MSx2MikgPT4ge1xuXHRyZXR1cm4gW3YxWzBdIC0gdjJbMF0sIHYxWzFdIC0gdjJbMV1dO1xufVxuXG5leHBvcnQgY29uc3QgbXVsdCA9ICh2MSwgbjEsIG4yKSA9PiB7XG5cdHJldHVybiBbdjFbMF0gKiBuMSwgdjFbMV0gKiAobjIgPyBuMiA6IG4xKV07XG59IiwiaW1wb3J0IHtzdW1tLCBtdWx0LCBzdWJ0fSBmcm9tIFwiLi9mblwiO1xuaW1wb3J0IFNwcml0ZXNNYW5hZ2VyIGZyb20gXCIuL3Nwcml0ZXNcIjtcblxuY29uc3QgZ3Jhdml0eSA9IFswLCAwLjVdO1xuY29uc3QgZiA9IDM7XG5cbmV4cG9ydCBjbGFzcyBQb2ludCB7XG5cdGNvbnN0cnVjdG9yKHgseSl7XG5cdFx0dGhpcy5wb3MgPSBbeCx5XTtcblxuXHRcdHRoaXMuYWNjID0gWzAsIDBdO1xuXHRcdHRoaXMudmVsID0gWzAsIDBdO1xuXHR9XG5cblx0dXBkYXRlKCl7XG5cdFx0dGhpcy52ZWwgPSBzdW1tKHRoaXMudmVsLCB0aGlzLmFjYyk7XG5cdFx0dGhpcy5wb3MgPSBzdW1tKHRoaXMucG9zLCB0aGlzLnZlbCk7XG5cdH1cbn1cblxuZXhwb3J0IGNsYXNzIFVuaXQgZXh0ZW5kcyBQb2ludCB7XG5cdGNvbnN0cnVjdG9yKHgseSl7XG5cdFx0c3VwZXIoeCx5KTtcblxuXHRcdHRoaXMuZGlyID0gMTtcblx0XHR0aGlzLmdyb3VuZCA9IHk7XG5cdFx0dGhpcy5zcHJpdGUgPSBTcHJpdGVzTWFuYWdlci5TUFJJVEUuSURMRVswXTtcblx0fVxuXG5cdHN0b3AoKXtcblx0ICAgIHRoaXMuc3ByaXRlID0gU3ByaXRlc01hbmFnZXIuU1BSSVRFLklETEVbMF07XG5cdFx0dGhpcy52ZWxbMF0gPSAwO1xuXHR9XG5cblx0bGVmdCgpe1xuXHQgICAgdGhpcy5kaXIgPSAwO1xuXHRcdHRoaXMudmVsWzBdID0gLTEgKiBmO1xuXHR9XG5cblx0cmlnaHQoKXtcbiAgICAgICAgdGhpcy5kaXIgPSAxO1xuXHRcdHRoaXMudmVsWzBdID0gMSAqIGY7XG5cdH1cblxuXHRkdWNrKCl7XG5cblx0fVxuXG5cdGp1bXAoKXtcblx0XHRpZih0aGlzLmlzT25Hcm91bmQoKSl7XG5cdFx0XHR0aGlzLmFwcGx5SnVtcCgpO1xuXHRcdFx0dGhpcy5kb3VibGVKdW1wQWxsb3dlZCA9IHRydWU7XG5cdFx0fSBlbHNlIGlmKHRoaXMuZG91YmxlSnVtcEFsbG93ZWQpIHtcblx0XHRcdHRoaXMuYXBwbHlKdW1wKCk7XG5cdFx0XHR0aGlzLmRvdWJsZUp1bXBBbGxvd2VkID0gZmFsc2U7XG5cdFx0fVxuXHR9XG5cblx0YXBwbHlKdW1wKCl7XG5cdFx0dGhpcy52ZWxbMV0gPSAtMiAqIGZcblx0fVxuXG5cdGlzT25Hcm91bmQoKXtcblx0XHRyZXR1cm4gdGhpcy5wb3NbMV0gPj0gdGhpcy5ncm91bmQ7XG5cdH1cblxuXHR1cGRhdGUoKXtcblx0XHRpZighdGhpcy5pc09uR3JvdW5kKCkpe1xuXHRcdFx0dGhpcy52ZWwgPSBzdW1tKHRoaXMudmVsLCBncmF2aXR5KVxuXHRcdH1cblxuXHRcdHN1cGVyLnVwZGF0ZSgpO1xuXG5cdFx0aWYodGhpcy5wb3NbMV0gPj0gdGhpcy5ncm91bmQpe1xuXHRcdFx0dGhpcy5wb3NbMV0gPSB0aGlzLmdyb3VuZDtcblx0XHR9XG5cdH1cblxuXHRyZW5kZXIoc2NlbmUsIHNwcml0ZXMsIHRpbWUpe1xuXHQgICAgbGV0IHNwcml0ZTtcblxuXHQgICAgc3dpdGNoICh0cnVlKXtcbiAgICAgICAgICAgIGNhc2UgTWF0aC5hYnModGhpcy52ZWxbMF0pID4gMCA6XG4gICAgICAgICAgICAgICAgc3ByaXRlID0gU3ByaXRlc01hbmFnZXIuU1BSSVRFLlJVTltNYXRoLmNlaWwodGltZSAlIDEwMCAvIDEwKSAlIDJdW3RoaXMuZGlyXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgc3ByaXRlID0gU3ByaXRlc01hbmFnZXIuU1BSSVRFLklETEVbdGhpcy5kaXJdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoIXRoaXMuaXNPbkdyb3VuZCgpKXtcblx0ICAgICAgICBzcHJpdGUgPSBTcHJpdGVzTWFuYWdlci5TUFJJVEUuSURMRVt0aGlzLmRpcl07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB4ID0gdGhpcy5wb3NbMF0gLSBzcHJpdGVbMl0vMjtcbiAgICAgICAgY29uc3QgeSA9IHRoaXMucG9zWzFdIC0gc3ByaXRlWzNdO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHNwcml0ZXMuY29weSguLi5zcHJpdGUpO1xuXG5cblx0XHRyZXR1cm4gc2NlbmUuc3ByaXRlKHJlc3VsdCwgeCwgeSlcblx0fVxufVxuXG5leHBvcnQgY2xhc3MgQ29udHJvbGxhYmxlVW5pdCBleHRlbmRzIFVuaXQge1xuXHRjb25zdHJ1Y3Rvcih4LHkpe1xuXHRcdHN1cGVyKHgseSk7XG5cblx0XHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHtcblx0XHRcdHN3aXRjaChlLmtleUNvZGUpIHtcblx0XHRcdFx0Y2FzZSA2NTpcblx0XHRcdFx0Y2FzZSAzNzogdGhpcy5sZWZ0KCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIDY4OlxuXHRcdFx0XHRjYXNlIDM5OiB0aGlzLnJpZ2h0KCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIDg3OlxuXHRcdFx0XHRjYXNlIDM4OiB0aGlzLmp1bXAoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgODM6XG5cdFx0XHRcdGNhc2UgNDA6IHRoaXMuZHVjaygpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGUpID0+IHtcblx0XHRcdHN3aXRjaChlLmtleUNvZGUpIHtcblx0XHRcdFx0Y2FzZSAzNzpcbiAgICAgICAgICAgICAgICBjYXNlIDY1OlxuXHRcdFx0XHRjYXNlIDM5OlxuICAgICAgICAgICAgICAgIGNhc2UgNjg6IHRoaXMuc3RvcCgpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdH1cblx0XHR9KVxuXHR9XG59XG4iLCJpbXBvcnQgU2NlbmUgZnJvbSBcIi4vc2NlbmVcIjtcbmltcG9ydCBTcHJpdGVzTWFuYWdlciBmcm9tIFwiLi9zcHJpdGVzXCI7XG5pbXBvcnQge0NvbnRyb2xsYWJsZVVuaXQsIFVuaXR9IGZyb20gXCIuL3BvaW50XCI7XG5cbmxldCB1bml0O1xubGV0IGludGVydmFsO1xuXG5jbGFzcyBBcHBsaWNhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKXtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbnZhc1wiKTtcbiAgICAgICAgdGhpcy5oID0gZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIHRoaXMudyA9IGRvY3VtZW50LmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMuaDtcbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB0aGlzLnc7XG5cbiAgICAgICAgdGhpcy5zY2VuZSA9IG5ldyBTY2VuZSh0aGlzLmNhbnZhcyk7XG4gICAgICAgIHRoaXMuc3ByaXRlc01hbmFnZXIgPSBuZXcgU3ByaXRlc01hbmFnZXIoXCIuLi9hc3NldHMvaGVyby5wbmdcIiwgdGhpcy5ib290c3RyYXAuYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdGhpcy51bml0cyA9IFtdO1xuICAgIH1cblxuICAgIGJvb3RzdHJhcCgpIHtcbiAgICAgICAgdGhpcy5wbGFjZSgpO1xuICAgICAgICBsZXQgdGltZSA9IDEwMDA7XG4gICAgICAgIHRoaXMucmVuZGVyKHRpbWUpO1xuICAgICAgICB0aGlzLnNjZW5lLmNjLnB1dEltYWdlRGF0YSh0aGlzLnNwcml0ZXNNYW5hZ2VyLmN0eC5nZXRJbWFnZURhdGEoMCwwLHRoaXMudywgdGhpcy5oKSwwLDApXG5cbiAgICAgICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzLnJlbmRlcih0aW1lKyspLCAxMDAwLzI0KVxuICAgIH1cblxuICAgIHBsYWNlKCl7XG4gICAgICAgIHRoaXMudW5pdHMucHVzaChuZXcgQ29udHJvbGxhYmxlVW5pdCh0aGlzLncvMiwgMyp0aGlzLmgvNCkpO1xuICAgICAgICB0aGlzLnVuaXRzLnB1c2gobmV3IFVuaXQoMyp0aGlzLncvNCwgMyp0aGlzLmgvNCkpO1xuICAgIH1cblxuICAgIHJlbmRlcih0aW1lKXtcbiAgICAgICAgdGhpcy5zY2VuZS5jbGVhcigpO1xuICAgICAgICB0aGlzLnNjZW5lLmxpbmUoMCwgMyp0aGlzLmgvNCwgdGhpcy53LCAzKnRoaXMuaC80KTtcblxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy51bml0cy5sZW5ndGggOyBpKyspe1xuICAgICAgICAgICAgbGV0IHVuaXQgPSB0aGlzLnVuaXRzW2ldO1xuXG4gICAgICAgICAgICB1bml0LnVwZGF0ZSgpO1xuICAgICAgICAgICAgdW5pdC5yZW5kZXIodGhpcy5zY2VuZSwgdGhpcy5zcHJpdGVzTWFuYWdlciwgdGltZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbndpbmRvdy5hcHAgPSBuZXcgQXBwbGljYXRpb24oKTtcbiJdLCJzb3VyY2VSb290IjoiIn0=